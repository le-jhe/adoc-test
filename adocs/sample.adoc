= chapter IV annex problem
:toc:
:toclevels: 4
:numbered:
:source-highlighter: highlight.js
#:source-highlighter: prettify
:highlightjs-theme: agate
#:prettify-theme: tranquil-heart

== highlight.js related
* on asciidoctor
** `highlightjs` works great
** `prettify` works with default them
*** it seems that cdnjs only adds this default `.min.css` 
* on asciidoctor live preview
** can't get `highlight.js` work with something else than default theme
** https://github.com/asciidoctor/asciidoctor-browser-extension/issues/62 : note to support thems
** https://github.com/asciidoctor/asciidoctor-browser-extension/issues/63 : should be supported, but still open

== notes
* rattrapage chapitre IV
** annexes manquantes
** => Sébastien
*** J04021 rattrapage des annexes génériques (sans annexe)
*** J04211 rattrapages des annexes particulière (avec annexe)
* what is the value of : `highlightjs-theme`={highlightjs-theme} ?

* existing & correct in prod
** 526
*** http://catng5xx.jablux.cpc998.be:22000/catng-viewer/api/current/526/documents/619763858?token=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJKUjUyNklOU1QiLCJhdXRoIjpbeyJhdXRob3JpdHkiOiJST0xFX1VTRVIifV0sImxuZyI6IkZSIiwicHdkIjoiY2h1Y2tub3JyaSIsImlzcyI6Imh0dHA6Ly9zNTk4bHAxdGNhdGN0MDIuamFibHV4LmNwYzk5OC5iZToyNDEwMCIsImlhdCI6MTU3MDE4MTc2NSwiZXhwIjoxNTcwMjI0OTY1LCJhdWQiOiI1MjYifQ.xL2nQP3PnMWdgXV2iEmmhJmMt8oedLp8GbPNxZLB-Lc&lang=FR
** 509
*** http://catng5xx.jablux.cpc998.be:22000/catng-viewer/api/current/509/documents/619848822?token=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJKUjUwOUlOU1QiLCJhdXRoIjpbeyJhdXRob3JpdHkiOiJST0xFX1VTRVIifV0sImxuZyI6IkZSIiwicHdkIjoiY2h1Y2tub3JyaSIsImlzcyI6Imh0dHA6Ly9zNTk4bHAxdGNhdGN0MDIuamFibHV4LmNwYzk5OC5iZToyNDEwMCIsImlhdCI6MTU3MDE4MTk0MSwiZXhwIjoxNTcwMjI1MTQxLCJhdWQiOiI1MDkifQ.A2bGY1gFc3lycBHd8fC4V5_RWVkGWNslYdEPmCRcwEU&lang=FR
** 501
*** http://catng5xx.jablux.cpc998.be:22000/catng-viewer/api/current/501/documents/619847915?token=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJKUjUwMUlOU1QiLCJhdXRoIjpbeyJhdXRob3JpdHkiOiJST0xFX1VTRVIifV0sImxuZyI6IkZSIiwicHdkIjoiY2h1Y2tub3JyaSIsImlzcyI6Imh0dHA6Ly9zNTk4bHAxdGNhdGN0MDIuamFibHV4LmNwYzk5OC5iZToyNDEwMCIsImlhdCI6MTU3MDE4MjAwNSwiZXhwIjoxNTcwMjI1MjA1LCJhdWQiOiI1MDEifQ.3pZ47g1f9-UHEyunmu0JnBlj1mY724tDu2yUc1JmTaE&lang=FR

== I Fix it
* on team
** request 

[source,bash]
----
curl -X POST "http://s999ld2wsdv55.teams.gfdi.be:24100/api/current/515/documents/487266025/versions" -H "accept: */*" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJKUjUxNUlOU1QiLCJwd2QiOiJjaHVja25vcnJpIiwibG5nIjoiRlIiLCJhdXRoIjpbeyJhdXRob3JpdHkiOiJST0xFX1VTRVIifV0sImlzcyI6Imh0dHA6Ly9zOTk5bGQyd3NkdjU1LnRlYW1zLmdmZGkuYmU6MjQxMDAiLCJpYXQiOjE1NzAxOTEwMTYsImV4cCI6MTU3MDIzNDIxNiwiYXVkIjoiNTE1In0.YJi4Xp7cVJbhXEhcJvmI1rjDLht-QYmBhpf44aUh6jo" -H "Content-Type: multipart/form-data" -F "file=@annexe.txt;type=text/plain"
----

** response

[source,json]
----
{
  "dcId": 164409675,
  "name": "annexe.txt",
  "mimeType": "text/plain",
  "size": 28,
  "versionNumber": "2.0",
  "url": null,
  "versionType": "A",
  "createUser": "JR515INST",
  "createDate": "2019-10-04T12:11:04.630Z"
}
----

new try `id=532459592 catKey=515-2019-515-0000053608`

* on Ref 2xx, I did the following for resetting sourcefile
** `PUT /api/current/203/documents.json`

[source,json]
----
{
  "dcId": 79038811,
  "organization": "203",
  "gedSourceFile": "intg://bcca0e1c-fc52-4db9-9c7e-d5279fa286b4"
}
----

[source,bash]
----
curl -X PUT "http://s298lr2tcatct02.ref.cpc998.be:24100/api/current/203/documents" -H "accept: */*" -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJNMjAzSlZFIiwicHdkIjoiUzFtcGxlMTgiLCJsbmciOiJGUiIsImF1dGgiOlt7ImF1dGhvcml0eSI6IlJPTEVfVVNFUiJ9XSwiaXNzIjoiaHR0cDovL3MyOThscjJ0Y2F0Y3QwMS5yZWYuY3BjOTk4LmJlOjI0MTAwIiwiaWF0IjoxNTcwNDM1Njc2LCJleHAiOjE1NzA0MzU5NzYsImF1ZCI6IjIwMyJ9.lHte-xHBINP_YtvwYdI6rWtnP979paMWo7rFjgHdiwE" -H "Content-Type: application/json" -d "{ \"dcId\": 79038811, \"organization\": \"203\", \"gedSourceFile\": \"intg://bcca0e1c-fc52-4db9-9c7e-d5279fa286b4\"}"
----

== with annex
* doctype : J04211
* table `LIBCXCOM54.PMCT048`
* field for document bytes: `KMEHR_REQUEST`
* need fo dcIc, and/or catKey
* in kmehr, it contains '<ns2:lnk' (148) or '<lnk' (89)
* only 12184aec-fbd6-4583-bc45-f3d956843f14 is of type : image/tiff
** all others are application/pdf
* Broken ones

[source,java]
----
package test;
public class Bla {
	private String isItQuicker="";
	private String another;
}
----

[source,yaml]
----
---
one:
two: "2"
  three: "3"
    threealso: "3'"
      - bla
      - bli
----

CATKEY			GLOBALID				EXTERNALID	END of binary ?	MIME	START
[source,java]
----
CATKEY			GLOBALID				EXTERNALID	END of binary ?	MIME	START
??			12184aec-fbd6-4583-bc45-f3d956843f14	5000018550054
50020195000000760431	89ab2b2d-dd4b-462c-8f23-f5d9fbc5923f	5000018227410	KJSVFT0YK	tiff?
50020195000000775681	b171149d-5a81-42de-8218-5ee9d73081c3	5000018298168	YOVj//Z		??
50020195000000787364	64ad1e12-347d-4581-84cc-d3684449c3fa	5000018395730	U9GCg==
50020195000000799560	9adfe03d-cc30-4d86-8070-6bd56995c63e	5000018460968	BAAAAA==		UEsDBBQ
50020195000000809648	1b45e761-4662-4e8f-bb07-5a00f7e89e87	5000018545060	maybe
50020195000000809649	a9fdac86-ac6b-45c4-b5a5-48f9f1855620	5000018545060	maybe
----

* save this

[source,sql]
----
select
SUBSTR(KMEHR_REQUEST, 
        max(
                LOCATE('<ns2:lnk',KMEHR_REQUEST)+55,
                LOCATE('<lnk',KMEHR_REQUEST)+51
        ),
        max(
                LOCATE('</ns2:lnk',SUBSTR(KMEHR_REQUEST,LOCATE('<ns2:lnk',KMEHR_REQUEST)+55+length('</ns2:lnk')+1))+9,
                LOCATE('</lnk',SUBSTR(KMEHR_REQUEST,LOCATE('<lnk',KMEHR_REQUEST)+51+length('</lnk')+1))+5
       )
)
from x
----

== run 5xx
* errors
----
50020195000000775681
50020195000000799560
50020195000000790828
50020195000000790829
----
** 50020195000000775681 : file is JFIF (jpeg?) not pdf .
*** link is broken : http://procomdb.jablux.gfdi.be/dist/rattrapages/chIV/file/50020195000000775681.pdf
** 50020195000000799560 : file is ??
** 50020195000000790828 : file is xml (did not find attach..)
*** multiple files in flow
*** same as below : 5000018421221
** 50020195000000790829
*** multiple files in flow
*** same as above : 5000018421221

== catng-api merge
* last synch was on commit : `803e85ba89c2db6ed3e0083c72f1d852db2d9b8f`

* slow 509
* 216 viewer
* chIV
* SPZ
** on n'a pas fini avec les prob de prod => l'intégrer plus là dessus
** l'impliquer aussi sur JadeR
** refactoring "un peu rapide"
*** Pas "tout seul" sur le code
*** couvrir de tests avant de refactorer
** Pas de problème pour Angular
*** vérifier avec Luc refactoring / infra
** Nouveau projet
*** Un peu frustrant de mon côté (il fait le nouveu / je débugge l'ancien)
*** Egalement, moins de suivi architecture / infra

== Chars
* Caractères accentués ?

== Lorem ipsum
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin vitae gravida nunc. Vivamus a dictum ligula. Quisque id consequat leo, in eleifend orci. Curabitur aliquam mauris sit amet elit suscipit, a bibendum elit ullamcorper. Mauris sed elit pretium erat consectetur dignissim eu eu erat. Ut quis bibendum nisi. Vivamus a lobortis risus. Vestibulum fermentum blandit felis, sit amet ullamcorper nisl congue sed. Proin rhoncus tincidunt est, lacinia rhoncus lectus. Morbi dolor ipsum, tristique sed suscipit non, condimentum ut elit. Etiam non orci eu libero suscipit sollicitudin a vitae nunc. Phasellus eu venenatis mauris, in pharetra elit.

Praesent tincidunt nisl sed vehicula pharetra. Praesent at vehicula metus, vitae vestibulum ante. Suspendisse eu felis ac ligula fermentum interdum a ac metus. Vestibulum diam nisl, feugiat sit amet magna ac, dapibus interdum justo. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aenean ut elit eros. Aliquam tempus neque erat, id pulvinar nisl consectetur at. Phasellus ut tempus elit. Nulla id est vitae ante lobortis pulvinar sit amet vitae tortor. Etiam sed orci non nisi euismod pharetra.

Ut sit amet ipsum ornare, tempor felis sit amet, tempus nulla. Donec egestas, purus et iaculis elementum, lorem nisi blandit ligula, in egestas dui lacus ut dolor. Mauris tempus porta elit, ut facilisis urna sagittis eget. Cras ultricies tincidunt augue, quis cursus sem scelerisque in. Praesent pellentesque enim ac ligula venenatis, eget pretium quam pretium. Donec a urna finibus arcu bibendum rutrum. Praesent mollis in tortor at dignissim. Nam ultrices risus nec mollis maximus. Integer scelerisque libero quis risus ultrices, at varius eros efficitur. Nunc cursus ligula quam. Aenean id purus sit amet diam tempor maximus. Nulla ornare diam ipsum, eu porttitor erat bibendum at. Suspendisse a auctor nibh. Ut efficitur justo ut arcu consequat iaculis. Nam tincidunt tincidunt tempor. Nulla et neque mauris.

Pellentesque eu arcu vestibulum, faucibus sem quis, finibus neque. Vestibulum vitae laoreet sem. Sed felis tellus, faucibus in ullamcorper vel, consequat eget enim. Maecenas tellus nulla, bibendum ac risus sed, rhoncus dignissim lectus. Sed posuere, sem rhoncus dictum bibendum, metus mauris mattis ligula, sit amet dignissim ligula turpis sagittis felis. Vivamus a vestibulum nisi. Maecenas lacinia sollicitudin odio aliquet dignissim. Donec vulputate ante mauris, eget euismod orci ultricies eu. Aliquam pretium, eros at congue fermentum, enim tortor vestibulum risus, in pretium dolor purus eget ipsum. Suspendisse condimentum, erat ac fringilla aliquet, odio eros consectetur erat, eget commodo tortor diam at erat. Mauris rutrum, est eget pulvinar efficitur, justo tellus iaculis ante, eget pretium leo sapien id sem. Maecenas ac justo sed ante vulputate blandit. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Suspendisse at blandit lectus. Sed sollicitudin sapien non lacinia ornare.

Aliquam fermentum nisi sed neque malesuada, non egestas erat fermentum. Etiam semper, sem luctus rutrum pulvinar, urna leo commodo ante, nec posuere quam massa a dui. Vivamus fermentum cursus nulla vel tempus. In non purus vitae est feugiat finibus. Morbi sed sapien a est efficitur euismod. Nulla justo risus, euismod sit amet lacus sit amet, dapibus luctus tortor. Nullam condimentum enim ut lacus iaculis, ut aliquam odio efficitur. Phasellus sit amet lectus ante. Etiam mollis in tellus a ultrices. Quisque elementum sollicitudin maximus. Maecenas vehicula leo nec ligula scelerisque, et elementum mauris elementum. Nunc tempor risus id euismod venenatis.

Etiam vel sollicitudin neque, quis pellentesque mauris. Aliquam mauris arcu, congue quis ultricies non, dictum quis purus. Phasellus non tellus nibh. Vestibulum at varius tortor. Nunc dapibus pretium quam id pellentesque. Vivamus laoreet non nisi sed varius. Nam condimentum massa velit. Donec dictum erat quis odio pretium vulputate. Aliquam luctus id quam eget sagittis. Nunc sit amet odio eget dui finibus dictum. Nulla interdum pellentesque vulputate. Curabitur vehicula quis mauris eu sodales. Vestibulum vel turpis justo. Pellentesque sed varius odio. Praesent sit amet rutrum nunc, ut mollis neque.

Vestibulum sagittis urna non dignissim iaculis. Fusce id maximus ligula, id mollis massa. Pellentesque quis augue et turpis suscipit elementum at at eros. Mauris luctus, leo non auctor bibendum, sapien odio finibus ex, ac dictum risus libero quis est. In orci enim, tempor eget finibus non, aliquet sed mi. Fusce posuere dapibus lacinia. Cras consectetur, nunc nec feugiat luctus, purus turpis pharetra arcu, et auctor nibh erat non ipsum. Maecenas pulvinar convallis ultrices. Duis condimentum, mauris vestibulum fermentum molestie, lectus elit blandit dolor, sit amet placerat magna ex a felis.

Sed ante erat, fringilla mollis volutpat vitae, tincidunt non risus. Maecenas vel leo efficitur, interdum felis eu, vulputate turpis. Fusce sit amet dolor at odio sagittis semper a non massa. Maecenas nec lobortis eros, quis efficitur nisl. Quisque convallis est at augue fringilla lacinia. Proin et semper massa. Duis ut consequat mi. Suspendisse tempor, lorem quis volutpat commodo, velit nisl placerat justo, vitae tristique ipsum ligula a libero. Nunc eu hendrerit neque. Vivamus et dolor eget neque bibendum imperdiet. Duis et velit dapibus diam volutpat lacinia.

Donec efficitur, tortor vitae sollicitudin facilisis, ex sapien tempor augue, lobortis varius mi libero eleifend orci. Nullam iaculis massa nec enim iaculis, in molestie erat interdum. Curabitur sit amet dignissim tortor. Suspendisse et egestas augue. Sed tristique nisi at ipsum molestie placerat. Aliquam erat volutpat. Etiam et lacinia nisl. Aliquam maximus dui accumsan nisi rutrum, eu ornare sem commodo. Fusce aliquam tempus tempor. In tempus magna ac metus posuere, id semper ipsum venenatis. Suspendisse pulvinar tincidunt enim. Phasellus ornare nibh dapibus orci mollis, non porta nisi mollis. Quisque tincidunt suscipit purus sed lacinia. Nullam dictum iaculis ex ultricies facilisis. Aenean scelerisque eleifend risus.

Ut eu faucibus est. Donec dictum mollis ante, ullamcorper laoreet odio consectetur ut. Integer erat nulla, pharetra sed dolor id, malesuada porttitor ligula. Praesent sollicitudin dapibus lacus ut dictum. Quisque vitae euismod massa, ut varius lorem. Vivamus commodo ultrices justo a blandit. Etiam egestas risus feugiat, bibendum erat vel, malesuada orci. Quisque eget dui ut tortor efficitur sollicitudin. Vivamus sed ipsum luctus, malesuada enim in, laoreet felis. Curabitur semper viverra neque, malesuada vulputate nulla sollicitudin in. Suspendisse rhoncus, nunc id scelerisque imperdiet, turpis magna scelerisque odio, quis rhoncus felis mauris et risus. Etiam quis felis in nisl fermentum sagittis quis nec justo.

Curabitur euismod pharetra erat ut vulputate. Etiam non nibh quis sapien molestie suscipit ut volutpat urna. In egestas nec nibh at malesuada. Curabitur eu viverra nisi. Aliquam sem purus, ultricies sit amet accumsan pulvinar, convallis at turpis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aenean rutrum accumsan congue. Mauris mattis et quam vel laoreet. Ut ac facilisis risus, at elementum lectus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; 
